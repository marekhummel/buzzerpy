<!DOCTYPE html>
<html>

<head>
    <title>Buzzer.py - Hosted Game</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.5/socket.io.js"></script>

    <script src="{{url_for('static', filename='scripts.js')}}?"></script>
    <script src="{{url_for('static', filename='stopwatch.js')}}?"></script>
    <link href="{{url_for('static', filename='styles.css')}}?" rel="stylesheet"></link>
    <script type="text/javascript" charset="utf-8">
        var socket = io();
        var name = "{{ hostname }}";

        // Connect / disconnect host
        window.onload = function () {
            socket.emit('game_hosted', { hostname: name });
        };

        window.onbeforeunload = function () {
            socket.emit('game_host_left');
        };

        // Game update
        socket.on('game_update', function (game) {
            var new_ul = create_player_list(game, "playerlist");
            document.getElementById("playerlist").replaceWith(new_ul);

            var new_table = create_scoreboard(game.players, "scoreboard", true);
            document.getElementById("scoreboard").replaceWith(new_table);

            var new_dropdown = create_dropdown(game.players, 'player_dropdown');
            document.getElementById("player_dropdown").replaceWith(new_dropdown);

            toggle_answer_button_status(game.players);
        });

        socket.on('disconnect', function () {
            window.location.href = '/';
        });

        // Locals
        function host_start_stopwatch() {
            socket.emit('host_stopwatch_action', { action: 'start' });
            stopwatch_start();
        };

        function host_stop_stopwatch() {
            socket.emit('host_stopwatch_action', { action: 'stop' });
            stopwatch_stop();
        };

        function host_reset_stopwatch() {
            socket.emit('host_stopwatch_action', { action: 'reset' });
            stopwatch_reset();
        };

        function next_round() {
            socket.emit('host_next_round');
        };

        function host_correct_answer() {
            socket.emit('host_change_score', { action: 'correct' });
        };

        function host_wrong_answer() {
            socket.emit('host_change_score', { action: 'wrong' });
        };

        function host_skip_player() {
            socket.emit('host_change_score', { action: 'skip' });
        };

        function host_bonus_points() {
            player = document.getElementById('player_dropdown').value;
            if (player === "") return;

            bonus_points = parseInt(document.getElementById('bonus_points').value);
            socket.emit('host_change_score', { player_name: player, action: 'bonus', bonus_points: bonus_points });

            document.getElementById('player_dropdown').selectedIndex = 1;
            document.getElementById('bonus_points').value = '';
        };
</script>
</head>

<body class="bg-light">
    <div class="container-fluid">
        <div class="row mt-3 mb-5">
            <div class="col-xl">
                <h1 class="text-center">Hosted Game as "{{ hostname }}"</h1>
            </div>
        </div>

        <div class="row my-5">
            <div class="col-xl-7">
                <div class="row justify-content-center">
                    <div class="col-xl-9">
                        <div id="playerlist"></div>
                    </div>
                </div>

                <div class="row mt-5 justify-content-center mx-auto" style="width: 50%;">

                    <div class="col-xl-4 d-grid col-3 mx-auto">
                        <button id="correct_button" class="btn btn-success btn-block" onclick="host_correct_answer()">Correct Answer (+10)</button>
                    </div>
                    
                    <div class="col-xl-4 d-grid col-3 mx-auto">
                        <button id="wrong_button" class="btn btn-danger btn-block" onclick="host_wrong_answer()">Wrong Answer (-5)</button>
                    </div>
                    <div class="col-xl-4 d-grid col-3 mx-auto">
                        <button id="skip_button" class="btn btn-secondary btn-block" onclick="host_skip_player()">Skip Player</button>
                    </div>
                </div>
                <div class="row justify-content-center mt-4">
                    <div class="col-xl-3 d-grid col-3 mx-auto">
                        <button id="next_round" class="btn btn-primary btn-block" onclick="next_round()">Nexts Round</button>
                    </div>
                </div>
            </div>

            <div class="col-xl-1"></div>
            <div class="col-xl-3">
                <div class="card mb-5 mx-auto">
                    <div class="card-body">
                        <h3 class="card-title text-center fw-bold">Scoreboard</h5>
                        <table class="table table-sm card-text table-striped mt-4">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Name</th>
                                    <th scope="col" data-toggle="tooltip" data-placement="top" title="Correct answers">&check;</th>
                                    <th scope="col" data-toggle="tooltip" data-placement="top" title="Wrong answers">&cross;</th>
                                    <th scope="col" data-toggle="tooltip" data-placement="top" title="Bonus points">&starf;</th>
                                    <th scope="col">Total</th>
                                    <th scope="col" style='width:1%;'></th>
                                </tr>
                            </thead>
                            <tbody id="scoreboard">
                            </tbody>
                        </table>
                        
                        <form id="form_bonus" class="row row-cols-lg-auto g-3" action="javascript:void(0);">
                            <div class="col-12">
                                <select id="player_dropdown" class="form-select form-select-sm" required></select>
                            </div>
                            <div class="col-12">
                                <div class="input-group input-group-sm">
                                    <input id="bonus_points" type="number" class="form-control" aria-label="Points" aria-describedby="inputGroup-sizing-sm" placeholder="0">
                                </div>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-secondary btn-sm" onclick="host_bonus_points()">Add Points</button>
                            </div>
                        </form>
                     </div>
                </div>

                <div class="card">
                    <svg class="card-img-top">
                        <g>
                            <rect width="100%" height="100%" fill="lightgray" />
                            <text id="stopwatch" x="50%" y="50%" font-size="250%" dominant-baseline="middle"
                                text-anchor="middle">00:00:00</text>
                        </g>
                    </svg>
                    <div class="card-body">
                        <h5 class="card-title">Stopwatch</h5>
                        <p class="card-text">Stopwatch to get buzzer times</p>
                        <div class="row">
                            <div class="col-xl-4 d-grid col-3 mx-auto">
                                <button id="stopwatch_start" class="btn btn-secondary" onclick="host_start_stopwatch()">Start</button>
                            </div>
                                <div class="col-xl-4 d-grid col-3 mx-auto">
                                <button id="stopwatch_stop" class="btn btn-secondary" onclick="host_stop_stopwatch()">Stop</button>
                            </div>
                            <div class="col-xl-4 d-grid col-3 mx-auto">
                                <button id="stopwatch_reset" class="btn btn-secondary" onclick="host_reset_stopwatch()">Reset</button>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-1"></div>
        </div>
    </div>

    <div class="d-grid col-2 mx-auto my-3">
        <button id="button_leave" class="btn btn-danger" type="button" onclick="window.location.href = '/'">Leave Game</button>
    </div>
</body>

</html>